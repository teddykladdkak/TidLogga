<!DOCTYPE html>
<html>
<head>
	<title>TidLogga</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta content="yes" name="apple-mobile-web-app-capable" />
	<meta content="yes" name="mobile-web-app-capable" />
	<meta content="minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no" name="viewport" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />

	<link rel="shortcut icon" href="ico/icon.ico" />
	<link rel="icon" type="image/vnd.microsoft.icon" href="ico/icon.ico" />
	<link rel="icon" type="image/png" href="ico/icon196x196.png" />
	<link rel="apple-touch-icon-precomposed" href="ico/icon180x180.png"/>
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="ico/icon76x76.png">
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="ico/icon120x120.png">
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="ico/icon152x152.png">

	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<link rel="stylesheet" href="font-awesome/css/font-awesome.css">

	<script type="application/javascript" src="config.js"></script>
	<script type="text/javascript">
		function timecounter(array){
			var countarray = {"t": 0, "m": 0, "s": 0};
			for (var i = array.length - 1; i >= 0; i--) {
				var split = array[i].split(':');
				if(split.length == 3){
					var seconds = parseInt(countarray.s) + parseInt(split[2]);
					if(seconds >= 60){
						var seconds = parseInt(seconds) - 60;
						var extraminut = 1;
					}else{
						var extraminut = 0;
					};
					countarray.s = seconds;
					var minut = parseInt(countarray.m) + parseInt(split[1]) + parseInt(extraminut);
					if(minut >= 60){
						var minut = parseInt(minut) - 60;
						var extrahour = 1;
					}else{
						var extrahour = 0;
					};
					countarray.m = minut;
					var hour = parseInt(countarray.t) + parseInt(split[0]) + parseInt(extrahour);
					countarray.t = hour;
				};
			};
			return countarray;
		};
		function showload(){
			document.getElementById('loader').removeAttribute('style');
			document.getElementById('overlay').removeAttribute('style');
		};
		function hideload(){
			document.getElementById('loader').setAttribute('style', 'display: none;');
			document.getElementById('overlay').setAttribute('style', 'display: none;');
		};
		function selectinput(id){
			var input = document.getElementById(id);
				input.focus();
				input.select();
				input.setSelectionRange(0,9999);
		};
		function load(){
			for (var i = 0; i < config.elemtohide.length; i++){
				document.getElementById(config.elemtohide[i]).setAttribute('style', 'display: none;');
			};
			document.getElementById('wrapper').removeAttribute('style');
			selectinput('idnamn');
			hideload();
		};
		function removechilds(parent){while (parent.hasChildNodes()) {parent.removeChild(parent.firstChild);};};
		function showhide(hide, show){if(hide == 'none'){}else{document.getElementById(hide).setAttribute('style', 'display: none;');};if(show == 'none'){}else{document.getElementById(show).removeAttribute('style');};};
		var removeError;
		function adderror(id, text){
			var error = document.getElementById(id);
				removeerror(id);
				var errortext = document.createTextNode(text);
				error.appendChild(errortext);
				clearTimeout(removeError);
				removeError = setTimeout(function(){ removeerror(id); }, 3000);
		};
		function removeerror(id){
			var error = document.getElementById(id);
			removechilds(error);
		};
		function disablebuttons(id){
			var utelem = document.getElementsByClassName(id);
			for (var i = utelem.length - 1; i >= 0; i--) {
				var klickfunc = utelem[i].getAttribute('onclick');
				if(!klickfunc){}else{
					utelem[i].setAttribute('data-onclick', klickfunc);
					utelem[i].setAttribute('class', utelem[i].getAttribute('class').replace('enable', 'disable'));
					utelem[i].disabled = true;
				};
			};
		};
		function enablebuttons(id){
			var inelem = document.getElementsByClassName(id);
			for (var i = inelem.length - 1; i >= 0; i--) {
				var klickfunc = inelem[i].getAttribute('data-onclick');
				if(!klickfunc){}else{
					inelem[i].setAttribute('onclick', klickfunc);
					var oldclass = inelem[i].getAttribute('class').replace('disable', 'enable');
					inelem[i].setAttribute('class', oldclass);
					inelem[i].removeAttribute('data-onclick');
					inelem[i].disabled = false;
				};
			};
		};
		function addzero(number){if(number <= 9){return "0" + number;}else{return number;};};
		function timebetween(start, stop, millisec){
			if(!millisec){
				var sekunder = parseInt(stop) / 1000 - parseInt(start) / 1000;
			}else{
				var sekunder = parseInt(millisec) / 1000;
			};
			var t = Math.floor(sekunder / 3600);
			var m = Math.floor((sekunder / 60) - (t * 60));
			var s = Math.floor(sekunder - (m * 60) - (t * 3600));
			return {"t": t, "m": m, "s": s};
		};
		function backtostandard(element, standard){removechilds(element);var text = document.createTextNode(standard);element.appendChild(text);};
		var countinterval;
		function startcount(){
			var tidraknare = document.getElementById('tid');
			var inmilisec = tidraknare.getAttribute('data-milisec');
			var numilisec = getDate().milisec;
			var timecalc = timebetween(inmilisec, numilisec);
			removechilds(tidraknare);
			var tidraknaretext = document.createTextNode(addzero(timecalc.t) + ':' + addzero(timecalc.m) + ':' + addzero(timecalc.s));
			tidraknare.appendChild(tidraknaretext);
		};
		function getDate(dateannan, timeannan, milisecsave){
			if(!dateannan && !timeannan && !milisecsave){
				var date = new Date();
			}else if(!milisecsave){
				var annatdatum = dateannan.split('-');
				var annattid = timeannan.split(':');
				var date = new Date(annatdatum[0], annatdatum[1] - 1, annatdatum[2], annattid[0], annattid[1]);
			}else{
				var date = new Date(parseInt(milisecsave));
			};
			var y = date.getFullYear();
			var m = date.getMonth() + 1;
			var d = date.getDate();
			var h = date.getHours();
			var mm = date.getMinutes();
			var milisec = date.getTime();
			var datum = y + '-' + addzero(m) + '-' + addzero(d);
			var tid = addzero(h) + ':' + addzero(mm);
			return {"datum": datum, "tid": tid, "milisec": milisec};
		};
		function tillbakatillprojekt(){
			clearInterval(countinterval);
			var projektnamn = document.getElementById('projektnamn');
				backtostandard(projektnamn, 'XXXXXXXXX');
				showhide('projektnamn', 'none');
			var intid = document.getElementById('intid');
				backtostandard(intid, 'XX:XX');
			var tid = document.getElementById('tid');
				backtostandard(tid, 'XX:XX:XX');
				tid.removeAttribute('data-milisec');
				tid.removeAttribute('data-projektid');
			showhide('klocka', 'projekt');
		};
		function annantid(todo){
			showhide('klocka', 'klockaannantid');
			var button = document.getElementById('annantidbutton');
			if(todo == 'in'){
				button.setAttribute('value', 'Klocka in');
				button.setAttribute('onclick', 'startclock("annat")');
			}else if(todo == 'ut'){
				button.setAttribute('value', 'Klocka ut');
				button.setAttribute('onclick', 'stopclock("annat");');
			}else{
				console.log('Något gick fel i "annantid()".');
			};
			var datum = document.getElementById('dateannan');
				datum.value = getDate().datum;
			var tid = document.getElementById('timeannan');
				tid.value = getDate().tid;
		};
		function numbertotext(num){var numsplit = num.split('');var result = [];for (var i = numsplit.length - 1; i >= 0; i--) {if(numsplit[i] == '0'){result.push('noll');}else if(numsplit[i] == '1'){result.push('ett');}else if(numsplit[i] == '2'){result.push('tva');}else if(numsplit[i] == '3'){result.push('tre');}else if(numsplit[i] == '4'){result.push('fyra');}else if(numsplit[i] == '5'){result.push('fem');}else if(numsplit[i] == '6'){result.push('sex');}else if(numsplit[i] == '7'){result.push('sju');}else if(numsplit[i] == '8'){result.push('atta');}else if(numsplit[i] == '9'){result.push('nio');}else{result.push('vetej');};};return result.join('');};
		function manadtotext(num){return config.manader[parseInt(num) - 1]};
		function loggsort(loggdata) {
			var allmillisec = [];
			for (var i = loggdata.length - 1; i >= 0; i--) {
				if(!loggdata[i].ut){
					var valtoadd = loggdata[i].in.milisec;
					var zerostoadd = loggdata[i].in.milisec.toString().split('');
					for (var a = zerostoadd.length - 1; a >= 0; a--) {
						var valtoadd = valtoadd + '0';
					};
				}else{
					var valtoadd = loggdata[i].in.milisec + '' + loggdata[i].ut.milisec;	
				};
				allmillisec.push(valtoadd);
			};
			allmillisec.sort();
			var sortedarray = [];
			for (var i = allmillisec.length - 1; i >= 0; i--) {
				var ammount = allmillisec[i].toString().length;
				var half =  ammount / 2;
				var inmillisec = allmillisec[i].slice(0, half);
				var utmillisec = allmillisec[i].slice(half, ammount);
				for (var a = loggdata.length - 1; a >= 0; a--) {
					if(loggdata[a].in.milisec == inmillisec){
						if(parseInt(utmillisec) == 0){
							sortedarray.push(loggdata[a]);
						}else if(loggdata[a].ut.milisec == utmillisec){
							sortedarray.push(loggdata[a]);
						};
					};
				};
			};
			return sortedarray;
		};
		function checkkey(e, id, focus){
			if (event.which == 13 || event.keyCode == 13) {
				document.getElementById(id).click();
				var selectelem = document.getElementById(focus);
					selectelem.focus();
			};
		};
		function addbrake(parent){
			var brake = document.createElement('br');
			parent.appendChild(brake);
		};
		function findinarray(word, array){
			for (var i = array.length - 1; i >= 0; i--) {
				if(array[i] == word){
					return true;
				};
			};
			return false;
		};
		function findprojektnamn(id){
			for (var i = config.projektarray.length - 1; i >= 0; i--) {
				if(config.projektarray[i].id == id){
					return config.projektarray[i].namn;
				};
			};
		};
	</script>
	<style type="text/css">
		body{
			
		}
		#wrapper{
			max-width: 1000px;
			margin-right: auto;
			margin-left: auto;
		}
		#header {
			font-size: 20px;
			vertical-align: top;
			text-align: center;
			width: 100%;
		}
		#head {
			font-weight: bold;
			font-family: verdana;
			text-align: center;
		}
		#projektnamn, #namn {
			text-align: left;
		}
		@media screen and (min-width: 450px) {
			.table {
				display: table;
			}
			.tr {
				display: table-row;
			}
			.td{
				display: table-cell;
			}
			#projektnamn {
				text-align: right;
			}
		}
		input, select, #klockadata, p {
			zoom: 1.5;
		}
		i, input, select, #klockadata, p {
			margin: 5px;
		}
		#login, #projekt, #klocka, #klockaannantid, #loggwrapper, #loggedit, #skrivut, #statistik, #pengar{
			border: solid #000 3px;
		}
		#loggwrapper table, #detaljtable{
			margin: 5px 10px 10px 10px;
		}
		.checkboxwrapper{
			display: inline-block;
			white-space: nowrap;
		}
		#loggwrapper table{
			margin-bottom: 10px;
		}
		#loggwrapper table, #loggwrapper table td, #skrivutpapper table, #skrivutpapper table td, #admin table, #admin table td, #detaljtable, #detaljtable td{
			border-collapse: collapse;
			border: solid 2px #000;
		}
		#skrivutpapper table, #skrivutpapper table tr{
			width: 100%;
		}
		#skrivutpapper table tbody tr, #admin table tbody tr{
			text-align: center;
		}
		#skrivutpapper table thead tr{
			font-weight: bold;
			border-bottom: solid 3px #000;
		}
		#skrivutpapper table tbody tr td.projektnamn, #skrivutpapper table thead tr td:nth-child(1){
			text-align: left;
			border-right: solid 3px #000;
		}
		#skrivutpapper table tbody tr.topborder{
			border-top: solid 3px #000;
		}
		#skrivutpapper table td{
			vertical-align: middle;
		}
		i:hover{
			color: blue;
		}
		.center{
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.left{
			display: flex;
			align-items: left;
			justify-content: left;
		}
		i{
			-webkit-transition: all 200ms linear;
		    -moz-transition: all 200ms linear;
		    -o-transition: all 200ms linear;
		    -ms-transition: all 200ms linear;
		    transition: all 200ms linear;
		}
		@media screen and (min-width: 650px) {
			#projekt i{
				font-size: 7em!important;
			}
			#buttonwrapper{
				text-align: center;
			}
		}
		#loggwrapper table {
			margin-left: auto;
			margin-right: auto;
		}
		#loggwrapper table tbody td{
			padding: 10px;
		}
		@media screen and (max-width: 300px) {
			#projekt select, input[type=text], input[type=button], input[type=date], input[type=time]{
				width: 88%;
			}
			.center{
				display: inline-block;
				align-items: left;
				justify-content: left;
			}
		}
		@media screen and (max-width: 700px) {
			#loggwrapper table{
				width: 100%;
			}
			#loggwrapper table select{
				margin: 0px;
			}
			#loggwrapper table tbody td{
				padding: 5px;
			}
		}
		@media screen and (max-width: 500px) {
			#idnamn{
				zoom: 3;
				width: 88%;
				margin-right: 0px;
				margin-left: 0px;
				padding-right: 0px;
				padding-left: 0px;
			}
		}
		@media print { 
			#login, #projekt, #klocka, #klockaannantid, #loggwrapper, #loggedit, #skrivut, #namn, #projektnamn, #head, #admin, #statistik, #pengar, #loader, #overlay{
				display: none;
			}
			#skrivutpapper{
				display: block!important;
			}
			#skrivutpapper table{
				border: solid #000 3px;
			}
		}
		.disable{
			opacity: 0.5;
		}
		i.disable:hover{
			color: #000;
		}
		#klockadata{
			text-align: center;
		}
		.fa-money{
			-webkit-transform: rotate(-20deg);
			-moz-transform: rotate(-20deg);
			-ms-transform: rotate(-20deg);
			-o-transform: rotate(-20deg);
			filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=2.2);
		}

		#loader {
		  position: absolute;
		  left: 50%;
		  top: 50%;
		  z-index:1002;
		  width: 150px;
		  height: 150px;
		  margin: -75px 0 0 -75px;
		  border: 16px solid #f3f3f3;
		  border-radius: 50%;
		  border-top: 16px solid #3498db;
		  width: 120px;
		  height: 120px;
		  -webkit-animation: spin 2s linear infinite;
		  animation: spin 2s linear infinite;
		}

		@-webkit-keyframes spin {
		  0% { -webkit-transform: rotate(0deg); }
		  100% { -webkit-transform: rotate(360deg); }
		}

		@keyframes spin {
		  0% { transform: rotate(0deg); }
		  100% { transform: rotate(360deg); }
		}
		#overlay {
		    position:fixed;
		    top:0;
		    bottom:0;
		    left:0;
		    right:0;
		    background-color:#fff;
		    opacity:0.8;
		    z-index:1001;
		}
	</style>
</head>
<body onload="load();">
	<div id="overlay"></div>
	<div id="loader"></div>
	<div id="wrapper" style="display: none;">
		<div id="head">TidLogga</div>
		<div id="header" class="table">
			<div class="tr">
				<div id="namn" class="td">Välkommen XXXX</div>
				<div id="projektnamn" class="td">XXXXXXXXX</div>
			</div>
		</div>
		<div id="login">
			<input type="text" id="idnamn" onkeydown="checkkey(event, 'loginbutton', 'listaprojekt');" placeholder="VGR ID"><span id="namnstatus"></span><br/>
			<i class="fa fa-sign-in fa-5x" aria-hidden="true" id="loginbutton" onclick="loggain();"></i>
			<!--<input type="button" value="Logga In" id="loginbutton" onclick="loggain();">--><br/>
			<p>Vill du testa funktionaliteten? Använd användarnamn: "test3".</p>
			<!--<i class="fa fa-camera-retro fa-5x"></i>-->
		</div>
		<div id="projekt">
			<select id="listaprojekt">
				<option value="none">Välj Projekt</option>
			</select>
			<div id="buttonwrapper">
				<i class="fa fa-clock-o fa-4x" aria-hidden="true" onclick="valjprojekt();"></i>
				<!--<input type="button" value="Klocka" onclick="valjprojekt();">-->
				<i class="fa fa-list fa-4x" aria-hidden="true" onclick="getlogg();"></i>
				<!--<input type="button" value="Logg" onclick="getlogg();">-->
				<i class="fa fa-print fa-4x" aria-hidden="true" onclick="loadskrivut();"></i>
				<!--<input type="button" value="Skriv ut..." onclick="loadskrivut();">-->
				<i class="fa fa-pie-chart fa-4x" aria-hidden="true" onclick="getpie();"></i>
				<!--<input type="button" value="Statistik" onclick="getpie();">-->
			</div>
		</div>
		<div id="klocka">
			<i class="fa fa-arrow-circle-left fa-3x" aria-hidden="true" onclick="tillbakatillprojekt();"></i>
			<!--<input type="button" value="Tillbaka" onclick="tillbakatillprojekt();">-->
				<div id="klockadata">
					<span id="intid">XX:XX</span> <span id="tid">XX:XX:XX</span>
				</div>
				<div class="center">
				<i class="fa fa-play fa-3x in enable" aria-hidden="true" onclick="startclock('nu')"></i>
				<!--<input type="button" value="Klocka in" class="in" onclick="startclock('nu')">-->
				<i class="fa fa-stop fa-3x ut enable" aria-hidden="true" onclick="stopclock('nu');"></i>
				<!--<input type="button" value="Klocka ut" class="ut" onclick="stopclock('nu');">-->
				</div>
				<p>Annan tid: <span class="checkboxwrapper"><i class="fa fa-play in enable" aria-hidden="true" onclick="annantid('in')"></i><i class="fa fa-stop ut enable" aria-hidden="true" onclick="annantid('ut');""></i></span><i class="fa fa-money" aria-hidden="true" onclick="showpengar();"></i></p>
				<!--<input type="button" class="in" value="Klocka in annan tid" onclick="annantid('in');">
				<input type="button" class="ut" value="Klocka ut annan tid" onclick="annantid('ut');">-->
		</div>
		<div id="klockaannantid">
			<input type="date" id="dateannan"><input type="time" id="timeannan"><span id="datumstatus"></span><br/>
			<i class="fa fa-check-circle fa-4x" aria-hidden="true" id="annantidbutton" onclick="startclock('annat')"></i>
			<!--<input type="button" id="annantidbutton" value="Klocka in/ut" onclick="startclock('annat')">-->
			<i class="fa fa-times-circle fa-4x" aria-hidden="true" id="annantidbutton" onclick="showhide('klockaannantid', 'klocka');"></i>
			<!--<input type="button" id="annantidbutton" value="Avbryt" onclick="showhide('klockaannantid', 'klocka');">-->
		</div>
		<div id="loggwrapper">
			
		</div>
		<div id="loggedit">
			<p>In stämpling</p>
			<input type="date" id="loggeditindat"><br/>
			<input type="time" id="loggeditintime">
			<p>Ut stämpling</p>
			<input type="date" id="loggeditutdat"><br/>
			<input type="time" id="loggedituttime"><br/>
			<i class="fa fa-check-circle fa-4x" aria-hidden="true" onclick="sendedit();"></i>
			<!--<input type="button" value="Spara" onclick="sendedit();">-->
			<i class="fa fa-times-circle fa-4x" aria-hidden="true" onclick="avbrytedit();"></i>
			<!--<input type="button" value="Avbryt" onclick="avbrytedit();">-->
		</div>
		<div id="skrivut">
				
		</div>
		<div id="skrivutpapper">
				
		</div>
		<div id="admin"></div>
		<div id="statistik">
			<i class="fa fa-arrow-circle-left fa-3x" aria-hidden="true" onclick="tillbakafranstatistik();"></i>
			<!--<input type="button" value="Tillbaka" onclick="tillbakafranstatistik();">-->
			<div id="piechart"></div>
			<div class="center">
				<table>
					<tr>
						<td><i class="fa fa-chevron-left fa-3x" aria-hidden="true" onclick="nextpie('-')"></i></td>
						<td id="piedatum">XXXX-XX</td>
						<td><i class="fa fa-chevron-right fa-3x" aria-hidden="true" onclick="nextpie('+')"></i></td>
					</tr>
				</table>
			</div>
			<div id="detalj" class="center">
				<table id="detaljtable">
					
				</table>
			</div>
		</div>
		<div id="pengar">
			<p>Timlön:</p>
			<label><input type="number" id="timlon" value="0"> kr/h</label>
			<p>Kronor att registrera</p>
			<label><input type="number" id="pengarinput" value="0"> kr</label><br/>
			<i class="fa fa-check-circle fa-4x" aria-hidden="true" onclick="addpengar();"></i>
			<i class="fa fa-times-circle fa-4x" aria-hidden="true" onclick="avbrytpengar();"></i>
		</div>
	</div>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">
		//Tar server id enbart för att koppla till socket
		var geturl = window.location.href.replace('http://', '').split('/')[0];
		
		//Lyssnar om server säger något
		var socket = io.connect(geturl);

		// Visar i console log status från server
		socket.on('message', function(message) {
			console.log(message);
			hideload();
		});
		socket.on('disconnect', function () {
			//alert('Koppling till server ligger nere!');
			location.reload();
		});
		function loggain(){
			var nameinput = document.getElementById('idnamn').value.toLowerCase();
			showload();
			socket.emit('checkuser', nameinput);
		};

		socket.on('anvandare', function(responsdata) {
			document.getElementById('tid').setAttribute('data-vgrid', responsdata.vgrid);
			var namn = document.getElementById('namn');
				removechilds(namn);
				var namntext = document.createTextNode('Välkommen ' + responsdata.namn);
				namn.appendChild(namntext);
			var listaprojekt = document.getElementById('listaprojekt');
			for (var a = 0; a < responsdata.projekt.length; a++){
				var option = document.createElement('option');
					option.setAttribute('value', responsdata.projekt[a]);
					var optiontext = document.createTextNode(findprojektnamn(responsdata.projekt[a]));
					for (var b = responsdata.activeprojekt.length - 1; b >= 0; b--) {
						if(responsdata.activeprojekt[b] == responsdata.projekt[a]){
							var optiontext = document.createTextNode('* ' + findprojektnamn(responsdata.projekt[a]));
						};
					};
					option.appendChild(optiontext);
				listaprojekt.appendChild(option);
			};
			if(responsdata.admin){
				var projektwrapper = document.getElementById('buttonwrapper');
					//<i class="fa fa-user-plus" aria-hidden="true"></i>
					var adminbutton = document.createElement('i');
						adminbutton.setAttribute('class', 'fa fa-user-plus fa-4x');
						adminbutton.setAttribute('aria-hidden', 'true');
						adminbutton.setAttribute('onclick', 'admin("' + responsdata.vgrid + '");');
					projektwrapper.appendChild(adminbutton);
					/*var adminbutton = document.createElement('input');
						adminbutton.setAttribute('value', 'Admin');
						adminbutton.setAttribute('type', 'button');
						adminbutton.setAttribute('onclick', 'admin("' + responsdata.vgrid + '");');
					projektwrapper.appendChild(adminbutton);*/
			};
			showhide('none', 'namn');
			showhide('login', 'projekt');
			hideload();
		});
		socket.on('loggoutuser', function(vgrid) {
			var sessionvgrid = document.getElementById('tid').getAttribute('data-vgrid');
			if(!sessionvgrid){}else{
				if(sessionvgrid == vgrid){
					location.reload();
				};
			};
			hideload();
		});
		function admin(vgrid){
			showload();
			socket.emit('startadmin', vgrid);
		};
		socket.on('admininfo', function(respons) {
			var adminwrapper = document.getElementById('admin');
				var admintable = document.createElement('table');
					var adminhead = document.createElement('thead');
						var adminheadtr = document.createElement('tr');
						var extraelem = ['Namn', 'VGRid', 'Admin'];
						for (var i = 0; i < extraelem.length; i++){
							var adminheadadmin = document.createElement('td');
								var adminheadadmintext = document.createTextNode(extraelem[i]);
								adminheadadmin.appendChild(adminheadadmintext);
							adminheadtr.appendChild(adminheadadmin);
						};
						for (var i = 0; i < config.projektarray.length; i++){
							var td = document.createElement('td');
								var tdtext = document.createTextNode(config.projektarray[i].namn);
								td.appendChild(tdtext);
							adminheadtr.appendChild(td);
						};
						adminhead.appendChild(adminheadtr);
					admintable.appendChild(adminhead);
					var adminbody = document.createElement('tbody');
					for (var i = 0; i < respons.data.length; i++){
						newadminuser(adminbody, respons.data[i]);
					};
					admintable.appendChild(adminbody);
				adminwrapper.appendChild(admintable);
				var knappar = [{namn: 'Spara', funktion: 'saveusers("' + respons.vgrid + '");'}, {namn: 'Avbryt', funktion: 'avbrytadmin();'}, {namn: 'Ny Användare', funktion: 'nyuser();'}];
				for (var i = 0; i < knappar.length; i++){
					var button = document.createElement('input');
						button.setAttribute('type', 'button');
						button.setAttribute('value', knappar[i].namn);
						button.setAttribute('onclick', knappar[i].funktion);
					adminwrapper.appendChild(button);
				};
			showhide('projekt', 'admin');
			hideload();
		});
		function saveusers(vgrid){
			var allusers = document.getElementById('admin').getElementsByTagName('table')[0].getElementsByTagName('tbody')[0].getElementsByTagName('tr');
			var nyausers = [];
			for (var i = 0; i < allusers.length; i++){
				var allinputs = allusers[i].getElementsByTagName('input');
				var userarray = {"projekt": []};
				for (var a = 0; a < allinputs.length; a++){
					var id = allinputs[a].getAttribute('data-id');
					var type = allinputs[a].getAttribute('type');
					if(type == 'text'){
						var value = allinputs[a].value;
						userarray[id] = value;
					}else if(type == 'checkbox'){
						if(id == 'admin'){
							userarray.admin = allinputs[a].checked;
						}else{
							if(allinputs[a].checked){
								userarray.projekt.push(id);
							};
						};
					};
				};
				if(userarray.vgrid == ''){}else{
					nyausers.push(userarray);
				};
			};
			showload();
			socket.emit('uppdaterausers', {"vgrid": vgrid, "nyausers": nyausers});
		};
		socket.on('usersupdated', function(respons) {
			avbrytadmin();
			hideload();
		});
		function avbrytadmin(){
			var wrapper = document.getElementById('admin');
			removechilds(wrapper);
			showhide('admin', 'projekt');
		};
		function nyuser(){
			var tbody = document.getElementById('admin').getElementsByTagName('table')[0].getElementsByTagName('tbody')[0];
			var blankuser = {"admin": false, "namn": "", "vgrid": "", "projekt": []};
			newadminuser(tbody, blankuser);
		};
		function newadminuser(element, user){
			var line = document.createElement('tr');
			var textsegment = ['namn', 'vgrid'];
			for (var i = 0; i < textsegment.length; i++){
				var namn = document.createElement('td');
					var namninput = document.createElement('input');
						namninput.setAttribute('data-id', textsegment[i]);
						namninput.setAttribute('type', 'text');
						namninput.setAttribute('value', user[textsegment[i]]);
					namn.appendChild(namninput);
				line.appendChild(namn);
			};
				var adminchecktd = document.createElement('td');
					var admincheck = document.createElement('input');
						admincheck.setAttribute('data-id', 'admin');
						admincheck.setAttribute('type', 'checkbox');
						if(user['admin']){
							admincheck.checked = true;
						};
					adminchecktd.appendChild(admincheck);
				line.appendChild(adminchecktd);
			for (var i = 0; i < config.projektarray.length; i++){
				var td = document.createElement('td');
					var checkbox = document.createElement('input');
						checkbox.setAttribute('type', 'checkbox');
						checkbox.setAttribute('data-id', config.projektarray[i].id);
						if(findinarray(config.projektarray[i].id, user.projekt)){
							checkbox.checked = true;
						};
					td.appendChild(checkbox);
				line.appendChild(td);
			};
			element.appendChild(line);
		};
		socket.on('erroranvandare', function(message) {
			adderror('namnstatus', 'Användarnamn kunde inte hittas!');
			console.log('Användarnamn kunde inte hittas!');
			hideload();
		});

		function valjprojekt(){
			var select = document.getElementById('listaprojekt');
			var vgrid = document.getElementById('tid').getAttribute('data-vgrid');
			if(select.value == 'none'){}else{
				showload();
				socket.emit('checkprojekt', {"projekt": select.value, "vgrid": vgrid, "getall": false, "checkaktiv": true});
			};
		};

		socket.on('svarprojekt', function(responsdata) {
			var tidraknare = document.getElementById('tid');
				tidraknare.setAttribute('data-projektid', responsdata.projekt);
				var projektnamn = document.getElementById('projektnamn');
					removechilds(projektnamn);
					var projektnamntext = document.createTextNode(findprojektnamn(responsdata.projekt));
					projektnamn.appendChild(projektnamntext);
				showhide('none', 'projektnamn');
				showhide('projekt', 'klocka');
			if(responsdata.svar == 'none'){
				enablebuttons('in')
				disablebuttons('ut')
			}else{
				startclock('save', responsdata.svar.milisec);
			};
			hideload();
		});

		function startclock(todo, startmilisec){
			disablebuttons('ut');
			disablebuttons('in');
			var save = false;
			if(todo == 'nu'){
				var datum = getDate();
			}else if(todo == 'annat'){
				var dateannan = document.getElementById('dateannan').value;
				if(dateannan == ''){
					var dateannan = getDate().datum;
				};
				var timeannan = document.getElementById('timeannan').value;
				if(timeannan == ''){
					var timeannan = getDate().tid;
				};
				var datum = getDate(dateannan, timeannan);
				showhide('klockaannantid', 'klocka');
			}else if(todo == 'save'){
				var datum = getDate('', '', startmilisec);
				var save = true;
			};
			var tidraknare = document.getElementById('tid');
			var projektid = tidraknare.getAttribute('data-projektid');
			var vgrid = tidraknare.getAttribute('data-vgrid');
			showload();
			socket.emit('klockain', {"projekt": projektid, "vgrid": vgrid, "datum": datum, "save": save});
		};

		socket.on('startaklocka', function(inklockdata) {
			enablebuttons('ut');
			disablebuttons('in');
			var tidwrapper = document.getElementById('intid');
			removechilds(tidwrapper);
				var tidwrappertext = document.createTextNode(inklockdata.datum.tid);
				tidwrapper.appendChild(tidwrappertext);
			var tidraknare = document.getElementById('tid');
				tidraknare.setAttribute('data-milisec', inklockdata.datum.milisec);
			var listaprojekt = document.getElementById('listaprojekt').getElementsByTagName('option');
			for (var i = listaprojekt.length - 1; i >= 0; i--) {
				if(listaprojekt[i].getAttribute('value') == tidraknare.getAttribute('data-projektid')){
					removechilds(listaprojekt[i]);
					var nyoption = document.createTextNode('* ' + findprojektnamn(tidraknare.getAttribute('data-projektid')));
					listaprojekt[i].appendChild(nyoption);
				};
			};
			clearInterval(countinterval);
			startcount();
			countinterval = setInterval(function(){ startcount(); }, 1000);
			hideload();
		});


		function stopclock(todo){
			if(todo == 'nu'){
				var datum = getDate();
			}else if(todo == 'annat'){
				var dateannan = document.getElementById('dateannan').value;
				var timeannan = document.getElementById('timeannan').value;
				var dateannan = document.getElementById('dateannan').value;
				if(dateannan == ''){
					var dateannan = getDate().datum;
				};
				var timeannan = document.getElementById('timeannan').value;
				if(timeannan == ''){
					var timeannan = getDate().tid;
				};
				var datum = getDate(dateannan, timeannan);
			}else{
				console.log('Något gick fel i "stopclock()".');
			};
			var startmilisec = document.getElementById('tid').getAttribute('data-milisec');
			if(datum.milisec <= startmilisec){
				adderror('datumstatus', 'Du kan inte klocka ut innan du klockade in!');
			}else{
				disablebuttons('ut');
				disablebuttons('in');
				clearInterval(countinterval);
				showhide('klockaannantid', 'klocka');
				var tidraknare = document.getElementById('tid');
				var projektid = tidraknare.getAttribute('data-projektid');
				var startdatum = getDate('', '', tidraknare.getAttribute('data-milisec')).datum;
				var vgrid = tidraknare.getAttribute('data-vgrid');
				showload();
				socket.emit('stopklocka', {"projekt": projektid, "vgrid": vgrid, "datum": datum, "startdatum": startdatum});
			};
		};

		socket.on('stopklocka', function(inklockdata) {
			console.log(inklockdata);
			var tidwrapper = document.getElementById('tid');
			var time = timebetween(tidwrapper.getAttribute('data-milisec'), inklockdata.datum.milisec, '');
				removechilds(tidwrapper);
				var tidtext = document.createTextNode(addzero(time.t) + ':' + addzero(time.m) + ':' + addzero(time.s));
				tidwrapper.appendChild(tidtext);
			var listaprojekt = document.getElementById('listaprojekt').getElementsByTagName('option');
			for (var i = listaprojekt.length - 1; i >= 0; i--) {
				if(listaprojekt[i].getAttribute('value') == tidwrapper.getAttribute('data-projektid')){
					removechilds(listaprojekt[i]);
					var nyoption = document.createTextNode(findprojektnamn(tidwrapper.getAttribute('data-projektid')));
					listaprojekt[i].appendChild(nyoption);
				};
			};
			enablebuttons('in');
			disablebuttons('ut');
			hideload();
		});

		function getlogg(specielltdatum){
			var select = document.getElementById('listaprojekt');
			var vgrid = document.getElementById('tid').getAttribute('data-vgrid');
			if(select.value == 'none'){}else{
				var loggwrapper = document.getElementById('loggwrapper');
				removechilds(loggwrapper);
				if(!specielltdatum){
					var datum = 'none';
				}else{
					var datum = specielltdatum;
				};
				showload();
				socket.emit('checkprojekt', {"projekt": select.value, "datum": datum, "vgrid": vgrid, "getall": true, "checkaktiv": false});
			};
		};
		function loggandramanad(element){
			getlogg(element.value);
		};
		socket.on('sendlogg', function(loggdata) {
			if(!loggdata.mothtoload){}else{
				var projektnamn = document.getElementById('projektnamn');
					removechilds(projektnamn);
					var projektnamntext = document.createTextNode(findprojektnamn(loggdata.projekt));
					projektnamn.appendChild(projektnamntext);
				showhide('none', 'projektnamn');
				var loggwrapper = document.getElementById('loggwrapper');
					var tillbaka = document.createElement('i');
						tillbaka.setAttribute('class', 'fa fa-arrow-circle-left fa-3x');
						tillbaka.setAttribute('value', 'Tillbaka');
						tillbaka.setAttribute('aria-hidden', 'true');
						tillbaka.setAttribute('onclick', 'backfromlogg();');
					loggwrapper.appendChild(tillbaka);
				/*var tillbaka = document.createElement('input');
					tillbaka.setAttribute('type', 'button');
					tillbaka.setAttribute('value', 'Tillbaka');
					tillbaka.setAttribute('onclick', 'backfromlogg();');
				loggwrapper.appendChild(tillbaka);*/
				var loggsorted = loggsort(loggdata.svar.data);
				var tableelem = document.createElement('table');
					var thead = document.createElement('thead');
						var headline = document.createElement('tr');
							var headtd = document.createElement('td');
								headtd.setAttribute('colspan', '5');
								var monthwrapper = document.createElement('div');
									monthwrapper.setAttribute('class', 'center');
									var month = document.createElement('select');
										month.setAttribute('onchange', 'loggandramanad(this);');
									for (var a = loggdata.mothtoload.length - 1; a >= 0; a--) {
										var option = document.createElement('option');
											option.setAttribute('value', loggdata.mothtoload[a]);
											var optiontext = document.createTextNode(loggdata.mothtoload[a]);
											option.appendChild(optiontext);
										month.appendChild(option);
									};
									monthwrapper.appendChild(month);
								headtd.appendChild(monthwrapper);
								var datumsplit = loggdata.datum.split('-');
								month.value = datumsplit[0] + '-' + datumsplit[1];
							headline.appendChild(headtd);
						thead.appendChild(headline);
					tableelem.appendChild(thead);
					var tbody = document.createElement('tbody');
					for (var i = 0; i < loggsorted.length; i++){
						addlogglist(loggsorted[i], tbody, loggdata.projekt, loggdata.vgrid);
					};
					tableelem.appendChild(tbody);
				loggwrapper.appendChild(tableelem);
				showhide('projekt', 'loggwrapper');
				hideload();
			};
		});
		function backfromlogg(){
			var projektnamn = document.getElementById('projektnamn');
				removechilds(projektnamn);
			showhide('projektnamn', 'none');
			showhide("loggwrapper", "projekt");
		};
		function addlogglist(loggdata, tableelem, projektid, vgrid){
			var line = document.createElement('tr');
				line.setAttribute('data-vgrid', vgrid);
				line.setAttribute('data-projektid', projektid);
				line.setAttribute('data-milisecin', loggdata.in.milisec);
			if(!loggdata.ut){
				line.setAttribute('data-milisecut', 'none');
			}else{
				line.setAttribute('data-milisecut', loggdata.ut.milisec);
			};
				var tddatum = document.createElement('td');
					var tddatumtext = document.createTextNode(loggdata.in.datum);
					tddatum.appendChild(tddatumtext);
				line.appendChild(tddatum);
				var intid = document.createElement('td');
					var intidtext = document.createTextNode(loggdata.in.tid);
					intid.appendChild(intidtext);
				line.appendChild(intid);
				var uttid = document.createElement('td');
				if(!loggdata.ut){}else{
					var uttidtext = document.createTextNode(loggdata.ut.tid);
					uttid.appendChild(uttidtext);
				};
				line.appendChild(uttid);
				var totaltid = document.createElement('td');
				if(!loggdata.ut){}else{
					var time = timebetween(loggdata.in.milisec, loggdata.ut.milisec, '');
					var totaltidtext = document.createTextNode(addzero(time.t) + ':' + addzero(time.m) + ':' + addzero(time.s));
					totaltid.appendChild(totaltidtext);
				};
				line.appendChild(totaltid);
				var remove = document.createElement('td');
					//<i class="fa fa-trash" aria-hidden="true"></i>
					var removeinput = document.createElement('i');
						removeinput.setAttribute('class', 'fa fa-trash fa-3x');
						removeinput.setAttribute('aria-hidden', 'true');
						removeinput.setAttribute('onclick', 'removesegment(this);');
					remove.appendChild(removeinput);
					/*var removeinput = document.createElement('img');
						removeinput.setAttribute('src', 'img/trash.png');
						removeinput.setAttribute('value', 'Ta bort');
						removeinput.setAttribute('class', 'loggbutton');
						removeinput.setAttribute('onclick', 'removesegment(this);');
					remove.appendChild(removeinput);*/
					if(!loggdata.ut){}else{
						//<i class="fa fa-pencil-square-o" aria-hidden="true"></i>
						var editinput = document.createElement('i');
							editinput.setAttribute('class', 'fa fa-pencil-square-o fa-3x');
							editinput.setAttribute('aria-hidden', 'true');
							editinput.setAttribute('onclick', 'showedit(this);');
						remove.appendChild(editinput);
						/*var editinput = document.createElement('img');
							editinput.setAttribute('src', 'img/edit.png');
							editinput.setAttribute('value', 'Edit');
							editinput.setAttribute('class', 'loggbutton');
							editinput.setAttribute('onclick', 'showedit(this);');
						remove.appendChild(editinput);*/
					};
				line.appendChild(remove);
			tableelem.appendChild(line);
		};
		function removesegment(element){
			var millisecin = element.parentElement.parentElement.getAttribute('data-milisecin');
			var millisecut = element.parentElement.parentElement.getAttribute('data-milisecut');
			var vgrid = element.parentElement.parentElement.getAttribute('data-vgrid');
			var projektid = element.parentElement.parentElement.getAttribute('data-projektid');
			var datum = getDate('', '', millisecin).datum;
			showload();
			socket.emit('removesegment', {"millisecin": millisecin, "millisecut": millisecut, "vgrid": vgrid, "projektid": projektid, "datum": datum});
			var loggwrapper = document.getElementById('loggwrapper');
				removechilds(loggwrapper);
		};
		socket.on('reloadlogg', function(loggdata) {
			showhide('loggedit', 'loggwrapper');
			showhide('projekt', 'loggwrapper');
			getlogg(loggdata.datum);
			hideload();
		});
		function showedit(element){
			var wrapper = document.getElementById('loggedit');
			var datatofetch = ['milisecin', 'milisecut', 'vgrid', 'projektid'];
			var datatopaste = {};
			for (var i = datatofetch.length - 1; i >= 0; i--) {
				var getdata = element.parentElement.parentElement.getAttribute('data-' + datatofetch[i]);
				datatopaste[datatofetch[i]] = getdata;
				wrapper.setAttribute('data-' + datatofetch[i], getdata);
			};
			var tidin = getDate('', '', datatopaste.milisecin);
			var tidut = getDate('', '', datatopaste.milisecut);
			document.getElementById('loggeditindat').value = tidin.datum;
			document.getElementById('loggeditintime').value = tidin.tid;
			document.getElementById('loggeditutdat').value = tidut.datum;
			document.getElementById('loggedituttime').value = tidut.tid;
			showhide('loggwrapper', 'loggedit');
		};
		function sendedit(){
			var loggeditindat = document.getElementById('loggeditindat');
			var loggeditintime = document.getElementById('loggeditintime');
			var tidin = getDate(loggeditindat.value, loggeditintime.value, '');
			var loggeditutdat = document.getElementById('loggeditutdat');
			var loggedituttime = document.getElementById('loggedituttime');
			var tidut = getDate(loggeditutdat.value, loggedituttime.value, '');
			if(tidin.milisec <= tidut.milisec){
				var wrapper = document.getElementById('loggedit');
				var arraytosave = {};
					arraytosave.vgrid = wrapper.getAttribute('data-vgrid');
					arraytosave.projektid = wrapper.getAttribute('data-projektid');
					arraytosave.old = {};
					arraytosave.old.millisecin = wrapper.getAttribute('data-milisecin');
					arraytosave.old.millisecut = wrapper.getAttribute('data-milisecut');
					var olddatumarray = getDate('', '', wrapper.getAttribute('data-milisecin'));
					arraytosave.old.datum = olddatumarray.datum;
					arraytosave.ny = {};
					arraytosave.ny.in = tidin;
					arraytosave.ny.ut = tidut;
				showload();
				socket.emit('editsegment', arraytosave);
				loggeditindat.removeAttribute('style');
				loggeditintime.removeAttribute('style');
				loggeditutdat.removeAttribute('style');
				loggedituttime.removeAttribute('style');
			}else{
				console.log('Tid är negativ!');
				if(loggeditindat.value == ''){
					loggeditindat.setAttribute('style', 'border: solid 1px red;');
				}else{
					loggeditindat.removeAttribute('style');
				};
				if(loggeditintime.value == ''){
					loggeditintime.setAttribute('style', 'border: solid 1px red;');
				}else{
					loggeditintime.removeAttribute('style');
				};
				if(loggeditutdat.value == ''){
					loggeditutdat.setAttribute('style', 'border: solid 1px red;');
				}else{
					loggeditutdat.removeAttribute('style');
				};
				if(loggedituttime.value == ''){
					loggedituttime.setAttribute('style', 'border: solid 1px red;');
				}else{
					loggedituttime.removeAttribute('style');
				};
				if(tidin.milisec > tidut.milisec){
					loggeditutdat.setAttribute('style', 'border: solid 1px red;');
					loggedituttime.setAttribute('style', 'border: solid 1px red;');
				};
			};
		};
		function avbrytedit(){
			var datatoremove = ['milisecin', 'milisecut', 'vgrid', 'projektid'];
			var wrapper = document.getElementById('loggedit');
			for (var i = datatoremove.length - 1; i >= 0; i--) {
				wrapper.removeAttribute('data-' + datatoremove[i]);
			};
			document.getElementById('loggeditindat').value = '';
			document.getElementById('loggeditintime').value = '';
			document.getElementById('loggeditutdat').value = '';
			document.getElementById('loggedituttime').value = '';
			showhide('loggedit', 'loggwrapper');
		};

		function loadskrivut(){
			var vgrid = document.getElementById('tid').getAttribute('data-vgrid');
			var skrivutwrapper = document.getElementById('skrivut');
			removechilds(skrivutwrapper);
			showload();
			socket.emit('getfilestoload', vgrid);
		};
		socket.on('responsfilestoload', function(data) {
			var skrivutwrapper = document.getElementById('skrivut');
				var tillbaka = document.createElement('i');
					tillbaka.setAttribute('class', 'fa fa-arrow-circle-left fa-3x');
					tillbaka.setAttribute('aria-hidden', 'true');
					tillbaka.setAttribute('onclick', 'showhide("skrivut", "projekt");');
				skrivutwrapper.appendChild(tillbaka);
				/*var tillbaka = document.createElement('input');
					tillbaka.setAttribute('type', 'button');
					tillbaka.setAttribute('value', 'Tillbaka');
					tillbaka.setAttribute('onclick', 'showhide("skrivut", "projekt");');
				skrivutwrapper.appendChild(tillbaka);*/
				//addbrake(skrivutwrapper);
				var checkboxwrapper = document.createElement('div');
					checkboxwrapper.setAttribute('id', 'printcheckboxes');
				for (var a = data.responsdata.length - 1; a >= 0; a--) {
					var span = document.createElement('span');
						span.setAttribute('class', 'checkboxwrapper');
						var input = document.createElement('input');
							input.setAttribute('type', 'checkbox');
							input.setAttribute('data-namn', data.responsdata[a]);
							input.checked = true;
						span.appendChild(input);
						var lable = document.createElement('lable');
							var labletext = document.createTextNode(findprojektnamn(data.responsdata[a]));
							lable.appendChild(labletext);
						span.appendChild(lable);
					checkboxwrapper.appendChild(span);
				};
				skrivutwrapper.appendChild(checkboxwrapper);
				addbrake(skrivutwrapper);
				var select = document.createElement('select');
					select.setAttribute('id', 'skrivutdatum');
				skrivutwrapper.appendChild(select);
				addbrake(skrivutwrapper);
				var skrivutknapp = document.createElement('i');
					skrivutknapp.setAttribute('class', 'fa fa-print fa-4x');
					skrivutknapp.setAttribute('aria-hidden', 'true');
					skrivutknapp.setAttribute('onclick', 'startprint("print");');
				skrivutwrapper.appendChild(skrivutknapp);
				/*var skrivutknapp = document.createElement('input');
					skrivutknapp.setAttribute('type', 'button');
					skrivutknapp.setAttribute('value', 'Skriv ut...');
					skrivutknapp.setAttribute('onclick', 'startprint("print");');
				skrivutwrapper.appendChild(skrivutknapp);*/
				var excellknapp = document.createElement('i');
					excellknapp.setAttribute('class', 'fa fa-table fa-4x');
					excellknapp.setAttribute('aria-hidden', 'true');
					excellknapp.setAttribute('onclick', 'startprint("excell");');
				skrivutwrapper.appendChild(excellknapp);
				/*var excellknapp = document.createElement('input');
					excellknapp.setAttribute('type', 'button');
					excellknapp.setAttribute('value', 'Spara Excell');
					excellknapp.setAttribute('onclick', 'startprint("excell");');
				skrivutwrapper.appendChild(excellknapp);*/
			showload();
			socket.emit('getdates', {"vgrid": data.vgrid, "responsdata": data.responsdata});
			showhide('projekt', 'skrivut');
		});
		socket.on('skrivutadddatum', function(datum) {
			var wrapper = document.getElementById('skrivutdatum');
			var newoptions = [];
			var alloptions = wrapper.getElementsByTagName('option');
			for (var a = alloptions.length - 1; a >= 0; a--) {
				newoptions.push(alloptions[a].getAttribute('value'));
			};
			removechilds(wrapper);
			for (var i = datum.length - 1; i >= 0; i--) {
				var nyval = true;
				for (var a = newoptions.length - 1; a >= 0; a--) {
					if(newoptions[a] == datum[i]){
						var nyval = false;
					};
				};
				if(nyval){
					newoptions.push(datum[i]);
				};
			};
			newoptions.sort();
			for (var i = newoptions.length - 1; i >= 0; i--) {
				var option = document.createElement('option');
					option.setAttribute('value', newoptions[i]);
					var optiontext = document.createTextNode(newoptions[i]);
					option.appendChild(optiontext);
				wrapper.appendChild(option);
			};
			hideload();
		});
		//#skrivutpapper
		function startprint(todo){
			var vgrid = document.getElementById('tid').getAttribute('data-vgrid');
			var manad = document.getElementById('skrivutdatum').value;
			var allcheckboxes = document.getElementById('printcheckboxes').getElementsByTagName('input');
			var projekttoget = [];
			for (var i = allcheckboxes.length - 1; i >= 0; i--) {
				if(allcheckboxes[i].getAttribute('type') == 'checkbox'){
					if(allcheckboxes[i].checked == true){
						projekttoget.push(allcheckboxes[i].getAttribute('data-namn'));
					};
				};
			};
			var skrivutpapper = document.getElementById('skrivutpapper');
				removechilds(skrivutpapper);
				var head = document.createElement('h2');
					var headtext = document.createTextNode('Tidrapport för: ' + manad);
					head.appendChild(headtext);
				skrivutpapper.appendChild(head);
				var table = document.createElement('table');
					var thead = document.createElement('thead');
						var theadtr = document.createElement('tr');
						for (var i = 0; i < config.forklaringar.length; i++){
							var theadtd = document.createElement('td');
								var theadtdtext = document.createTextNode(config.forklaringar[i]);
								theadtd.appendChild(theadtdtext);
							theadtr.appendChild(theadtd);
						};
						thead.appendChild(theadtr);
					table.appendChild(thead);
					var tbody = document.createElement('tbody');
					table.appendChild(tbody);
				skrivutpapper.appendChild(table);
			showload();
			socket.emit('getprojektinformaiton', {"vgrid": vgrid, "manad": manad, "projekttoget": projekttoget, "todo": todo});
		};
		socket.on('skrivutinfo', function(respons) {
			for (var i = respons.data.length - 1; i >= 0; i--) {
				if(respons.data[i].data == 'none'){
					//addskrivutline(respons.data[i].id, config.skrivutfinnsinte);
				}else if(respons.data[i].data.length == 0){
					//addskrivutline(respons.data[i].id, config.skrivutfinnsinte);
				}else{
					var loggsorted = loggsort(respons.data[i].data);
					for (var a = 0; a < loggsorted.length; a++){
						if(!loggsorted[a].ut){
							alert('Du har inte stämplat ut från projektet "' + findprojektnamn(respons.data[i].id) + '".\nStämplingen kommer inte finnas med i utskriften.');
						}else{
							var time = timebetween(loggsorted[a].in.milisec, loggsorted[a].ut.milisec, '');
							var printarray = [loggsorted[a].in.tid, loggsorted[a].ut.tid, addzero(time.t) + ':' + addzero(time.m) + ':' + addzero(time.s)];
							addskrivutline(respons.data[i].id, printarray, loggsorted[a]);
						};
					};
				};
			};
			countallpassskrivut();
			if(respons.todo == 'print'){
				window.print();
			}else if(respons.todo == 'excell'){
				makeexcell(respons.manad);
			};
			hideload();
		});
		function addskrivutline(projektid, array, data){
			
			var table = document.getElementById('skrivutpapper').getElementsByTagName('table')[0].getElementsByTagName('tbody')[0];
				var oldtr = table.getElementsByClassName(projektid);
				var tr = document.createElement('tr');
					tr.setAttribute('class', projektid);

				//Projekt namn
				if(oldtr.length == 0){
					tr.setAttribute('class', projektid + ' topborder');
					var projekttd = document.createElement('td');
						projekttd.setAttribute('rowspan', '1');
						projekttd.setAttribute('class', 'projektnamn');
						var projekttdtext = document.createTextNode(findprojektnamn(projektid));
						projekttd.appendChild(projekttdtext);
					tr.appendChild(projekttd);
				}else{
					var projektnamn = oldtr[0].getElementsByClassName('projektnamn')[0];
					projektnamn.setAttribute('rowspan', parseInt(projektnamn.getAttribute('rowspan')) + 1);
				};
				//Om inga stämplingar finns gör inte följande
				if(!data){}else{
					//Dag nummer
					if(oldtr.length == 0){
						adddagskrivut(tr, projektid + 'dagnummer' + data.in.datum, data.in.datum);
					}else{
						var dagnummertd = document.getElementsByClassName(projektid + 'dagnummer' + data.in.datum);
						if(dagnummertd.length == 0){
							adddagskrivut(tr, projektid + 'dagnummer' + data.in.datum, data.in.datum);
						}else{
							dagnummertd[0].setAttribute('rowspan', parseInt(dagnummertd[0].getAttribute('rowspan')) + 1);
						};
					};
				};



				for (var i = 0; i < array.length; i++){
					var td = document.createElement('td');
						var tdtext = document.createTextNode(array[i]);
						td.appendChild(tdtext);
					tr.appendChild(td);
				};

				//Om inga stämplingar finns gör inte följande
				if(!data){}else{
					//Tid dag
					var countmilisec = parseInt(data.ut.milisec) - parseInt(data.in.milisec);
					if(oldtr.length == 0){
						nytimeskrivut(tr, projektid + 'dagcount' + data.in.datum, countmilisec);
					}else{
						var dagcounttd = document.getElementsByClassName(projektid + 'dagcount' + data.in.datum);
						if(dagcounttd.length == 0){
							nytimeskrivut(tr, projektid + 'dagcount' + data.in.datum, countmilisec);
						}else{
							updattimeskrivut(dagcounttd, countmilisec);
						};
					};

					//Tid projekt
					if(oldtr.length == 0){
						nytimeskrivut(tr, projektid + 'passcount passcount', countmilisec);
					}else{
						var projekttime = oldtr[0].getElementsByClassName(projektid + 'passcount');
						updattimeskrivut(projekttime, countmilisec);
					};
				};
			table.appendChild(tr);
			
		};
		function adddagskrivut(element, namn, datum){
			var dagnummertd = document.createElement('td');
				dagnummertd.setAttribute('rowspan', '1');
				dagnummertd.setAttribute('class', namn);
				var comprimdat = datum.slice(2).split('-').join('');
				var dagnummertdtext = document.createTextNode(comprimdat);
				dagnummertd.appendChild(dagnummertdtext);
			element.appendChild(dagnummertd);
		};
		function nytimeskrivut(element, namn, countmilisec){
			var nytime = timebetween('', '', countmilisec);
			var daycounttd = document.createElement('td');
				daycounttd.setAttribute('rowspan', '1');
				daycounttd.setAttribute('class', namn);
				daycounttd.setAttribute('data-milisec', countmilisec);
				var time = addzero(nytime.t) + ':' + addzero(nytime.m) + ':' + addzero(nytime.s);
				daycounttd.setAttribute('data-time', time);
				var daycounttdtdtext = document.createTextNode(time);
				daycounttd.appendChild(daycounttdtdtext);
			element.appendChild(daycounttd);
		};
		function updattimeskrivut(allelem, countmilisec){
			var nymilisec = parseInt(allelem[0].getAttribute('data-milisec')) + countmilisec;
			var time = timebetween('', '', nymilisec);
			var testtimebetween = timebetween('', '', countmilisec);
			var timetestarray = [allelem[0].getAttribute('data-time'), addzero(testtimebetween.t) + ':' + addzero(testtimebetween.m) + ':' + addzero(testtimebetween.s)];
			var timetest = timecounter(timetestarray);
			allelem[0].setAttribute('data-time', addzero(timetest.t) + ':' + addzero(timetest.m) + ':' + addzero(timetest.s));
			allelem[0].setAttribute('rowspan', parseInt(allelem[0].getAttribute('rowspan')) + 1);
			allelem[0].setAttribute('data-milisec', nymilisec);
			removechilds(allelem[0]);
			//var daycounttdtdtext = document.createTextNode(addzero(time.t) + ':' + addzero(time.m) + ':' + addzero(time.s));
			var daycounttdtdtext = document.createTextNode(addzero(timetest.t) + ':' + addzero(timetest.m) + ':' + addzero(timetest.s));
			allelem[0].appendChild(daycounttdtdtext);
		};
		function countallpassskrivut(){
			var table = document.getElementById('skrivutpapper').getElementsByTagName('table')[0].getElementsByTagName('tbody')[0];
			var allpasscount = table.getElementsByClassName('passcount');
			//var millisec = 0;
			var timetestarray = [];
			for (var i = allpasscount.length - 1; i >= 0; i--) {
			//	var millisec = millisec + parseInt(allpasscount[i].getAttribute('data-milisec'));
				timetestarray.push(allpasscount[i].getAttribute('data-time'));
			};
			var timetest = timecounter(timetestarray);
			//var time = timebetween('', '', millisec);
			var firsttr = table.getElementsByTagName('tr');
				var allpasstd = document.createElement('td');
					allpasstd.setAttribute('rowspan', firsttr.length);
					//var allpasstext = document.createTextNode(addzero(time.t) + ':' + addzero(time.m) + ':' + addzero(time.s));
					var allpasstext = document.createTextNode(addzero(timetest.t) + ':' + addzero(timetest.m) + ':' + addzero(timetest.s));
					allpasstd.appendChild(allpasstext);
				firsttr[0].appendChild(allpasstd);
		};
		function makeexcell(manad){
		    var data_type = 'data:application/vnd.ms-excel';
		    var table_div = document.getElementById('skrivutpapper');
		    var table_html = table_div.outerHTML.replace(/ /g, '%20');

		    var a = document.getElementById('printlink');
			    a.setAttribute('href', data_type + ', ' + table_html);
			    a.setAttribute('download', "Tidrapport " + manad + ".xls");
			    a.click();
		};
		var chartData = [];
		function nextpie(method){
			var piedatum = document.getElementById('piedatum').innerText;
			var datsplit = piedatum.split('-');
			var year = datsplit[0];
			if(method == '+'){
				var month = parseInt(datsplit[1]) + 1;
				if(month == '13'){
					var month = 1;
					var year = parseInt(year) + 1;
				};
			}else{
				var month = parseInt(datsplit[1]) - 1;
				if(month == '0'){
					var month = 12;
					var year = parseInt(year) - 1;
				};
			};
			console.log(month);
			getpie(year + '-' + addzero(month));
		};
		function getpie(datum){
			var vgrid = document.getElementById('tid').getAttribute('data-vgrid');
			if(!datum){
				var nudat = getDate().datum;
			}else{
				var nudat = datum + '-01';
			};
			showload();
			socket.emit('getpie', {"vgrid": vgrid, "datum": nudat});
			showhide('projekt', 'statistik');
		};
		socket.on('sendpie', function(respons) {
			console.log(respons);
			var detaljtable = document.getElementById('detaljtable');
				removechilds(detaljtable);
			var piedatum = document.getElementById('piedatum');
				removechilds(piedatum);
				var piedatumtext = document.createTextNode(addzero(respons.datum));
				piedatum.appendChild(piedatumtext);
			chartData = [config.statistikhead];
			var sammanlagtmillisec = 0;
			for (var i = respons.data.length - 1; i >= 0; i--) {
				var projektnamn = findprojektnamn(respons.data[i].id);
				var time = timebetween('', '', respons.data[i].val);

				chartData.push([projektnamn, respons.data[i].val]);

				var sammanlagtmillisec = sammanlagtmillisec + parseInt(respons.data[i].val);

				var line = document.createElement('tr');
					var tdnamn = document.createElement('td');
						var tdnamntext = document.createTextNode(projektnamn);
						tdnamn.appendChild(tdnamntext);
					line.appendChild(tdnamn);
					var tdval = document.createElement('td');
					if(respons.data[i].val == 0){
						var tdvaltext = document.createTextNode('00:00:00');
					}else{
						var tdvaltext = document.createTextNode(addzero(time.t) + ':' + addzero(time.m) + ':' + addzero(time.s));
					};
						tdval.appendChild(tdvaltext);
					line.appendChild(tdval);
				detaljtable.appendChild(line);
			};
			if(sammanlagtmillisec == 0){}else{
				var trsammanlagt = document.createElement('tr');
					var tdsammanlagt = document.createElement('td');
						tdsammanlagt.setAttribute('colspan', '2');
						tdsammanlagt.setAttribute('style', 'font-weight: bold;text-align: center;');
						var samtime = timebetween('', '', sammanlagtmillisec);
						var tdsammanlagttext = document.createTextNode(addzero(samtime.t) + ':' + addzero(samtime.m) + ':' + addzero(samtime.s));
						tdsammanlagt.appendChild(tdsammanlagttext);
					trsammanlagt.appendChild(tdsammanlagt);
				detaljtable.appendChild(trsammanlagt);
			};
			google.charts.load('current', {'packages':['corechart']});
			google.charts.setOnLoadCallback(drawChart);
			var body = document.getElementsByTagName('body')[0].setAttribute('onresize', "drawChart();");
		});
		function drawChart(){
			var data = google.visualization.arrayToDataTable(chartData);
			var options = {
				chartArea:{left:0,top:0,width:'100%',height:'100%'},
				legend:{alignment: 'center'}
			};
			var chart = new google.visualization.PieChart(document.getElementById('piechart'));
				chart.draw(data, options);
			hideload();
		};
		function tillbakafranstatistik(){
			var body = document.getElementsByTagName('body')[0].removeAttribute('onresize');
			removechilds(document.getElementById('piechart'));
			chartData = [];
			showhide('statistik', 'projekt');
		};
		function addpengar(){
			var timlon = document.getElementById('timlon');
			var pengarinput = document.getElementById('pengarinput');
			if(timlon.value == '' || pengarinput.value == '' || parseInt(timlon.value) <= 0 || parseInt(pengarinput.value) <= 0){
//Highlighta var det är fel i formuläret
				return false;
			}else{

			};
			var krtomillisec = (parseInt(pengarinput.value) / parseInt(timlon.value)) * 3600000;
			var indatum = getDate();
			var millisecnu = indatum.milisec;
			document.getElementById('tid').setAttribute('data-milisec', millisecnu);
			var intid = document.getElementById('intid');
				removechilds(intid);
				var intidtext = document.createTextNode(indatum.tid);
				intid.appendChild(intidtext);
			var utdatum = getDate('', '', millisecnu + krtomillisec);
			var infoelem = document.getElementById('tid')
			var projektid = infoelem.getAttribute('data-projektid');
			var vgrid = infoelem.getAttribute('data-vgrid');
			var arraytosave = {};
				arraytosave.in = indatum;
				arraytosave.ut = utdatum;
			showload();
			socket.emit('klockainochut', {"data": arraytosave, "projektid": projektid, "vgrid": vgrid});
			avbrytpengar();
		};
		function showpengar(){
			showhide('klocka', 'pengar');
		};
		function avbrytpengar(){
			document.getElementById('timlon').value = '0';
			document.getElementById('pengarinput').value = '0';
			showhide('pengar', 'klocka');
		};
	</script>
	<a href="" id="printlink" style="visibility: hidden;"></a>
</body>
</html>