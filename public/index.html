<!DOCTYPE html>
<html>
<head>
	<title>TidLogga</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta content="yes" name="apple-mobile-web-app-capable" />
	<meta content="yes" name="mobile-web-app-capable" />
	<meta content="minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no" name="viewport" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<script type="application/javascript" src="config.js"></script>
	<script type="text/javascript">
		function load(){
			for (var i = 0; i < config.elemtohide.length; i++){
				document.getElementById(config.elemtohide[i]).setAttribute('style', 'display: none;');
			};
		};
		function loggain(){
			var nameinput = document.getElementById('idnamn').value;
			socket.emit('checkuser', nameinput);
		};
		function removechilds(parent){while (parent.hasChildNodes()) {parent.removeChild(parent.firstChild);};};
		function showhide(hide, show){if(hide == 'none'){}else{document.getElementById(hide).setAttribute('style', 'display: none;');};if(show == 'none'){}else{document.getElementById(show).removeAttribute('style');};};
		function removeerror(){var error = document.getElementById('namnstatus');removechilds(error);};
		function disablebuttons(enable, disable){var inelem = document.getElementsByClassName(enable);for (var i = inelem.length - 1; i >= 0; i--) {var klickfunc = inelem[i].getAttribute('data-onclick');if(!klickfunc){}else{inelem[i].setAttribute('onclick', klickfunc);inelem[i].disabled = false;};};var utelem = document.getElementsByClassName(disable);for (var i = utelem.length - 1; i >= 0; i--) {var klickfunc = utelem[i].getAttribute('onclick');if(!klickfunc){}else{utelem[i].setAttribute('data-onclick', klickfunc);utelem[i].disabled = true;};};};
		function valjprojekt(){
			var select = document.getElementById('listaprojekt');
			var vgrid = document.getElementById('tid').getAttribute('data-vgrid');
			if(select.value == 'none'){}else{
				socket.emit('checkprojekt', {"projekt": select.value, "vgrid": vgrid});
			};
		};
	</script>
	<!--
	disablebuttons('in', 'ut');
				var tidraknare = document.getElementById('tid');
				tidraknare.setAttribute('data-projektid', select.value);
				var projektnamn = document.getElementById('projektnamn');
				removechilds(projektnamn);
					var projektnamntext = document.createTextNode(projekt[select.value].namn);
					projektnamn.appendChild(projektnamntext);
				showhide('none', 'projektnamn');
				showhide('projekt', 'klocka');-->
	<style type="text/css">
		#header {
			font-size: 20px;
			vertical-align: top;
			text-align: center;
			width: 100%;
		}
		#head {
			font-weight: bold;
			font-family: verdana;
			text-align: center;
		}
		.table {
			display: table;
		}
		.tr {
			display: table-row;
		}
		.td{
			display: table-cell;
		}
		input, select, #klockadata {
			zoom: 1.5;
			margin: 5px;
		}
		#login, #projekt, #klocka, #klockaannantid{
			border: solid #000 3px;
		}
		#namn {
			text-align: left;
		}
		#projektnamn {
			text-align: right;
		}
	</style>
</head>
<body onload="load();">
	<div id="head">TidLogga</div>
	<div id="header" class="table">
		<div class="tr">
			<div id="namn" class="td">Välkommen XXXX</div>
			<div id="projektnamn" class="td">XXXXXXXXX</div>
		</div>
	</div>
	<div id="login">
		<input type="text" id="idnamn" placeholder="VGR ID"><span id="namnstatus"></span><br/>
		<input type="button" value="Logga In" onclick="loggain();">
	</div>
	<div id="projekt">
		<select id="listaprojekt">
			<option value="none">Välj Projekt</option>
		</select><br/>
		<input type="button" value="Klocka" onclick="valjprojekt();"><input type="button" value="Logg"><input type="button" value="Skriv ut">
	</div>
	<div id="klocka">
		<div id="klockadata">
			<span id="intid">XX:XX</span> <span id="tid">XX:XX:XX</span>
		</div>
		<input type="button" value="Klocka in" class="in" onclick="startclock('nu')"><input type="button" value="Klocka ut" class="ut" onclick="stopclock('nu');">
		<div class="table">
			<div class="tr">
				<div class="td">
					<input type="button" class="in" value="Klocka in annan tid" onclick="annantid('in');"><input type="button" class="ut" value="Klocka ut annan tid" onclick="annantid('ut');">
				</div>
				<div class="td">
					<input type="button" value="Tillbaka" onclick="tillbakatillprojekt();">
				</div>
			</div>
		</div>
	</div>
	<div id="klockaannantid">
		<input type="date" id="dateannan"><input type="time" id="timeannan"><span id="datumstatus"></span><br/>
		<input type="button" id="annantidbutton" value="Klocka in/ut" onclick="startclock('annat')"><input type="button" id="annantidbutton" value="Avbryt" onclick="showhide('klockaannantid', 'klocka');">
	</div>




	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">
		//Tar server id enbart för att koppla till socket
		var geturl = window.location.href.replace('http://', '').split('/')[0];
		
		//Lyssnar om server säger något
		var socket = io.connect(geturl);

		// Visar i console log status från server
		socket.on('message', function(message) {
			console.log(message);
		});

		socket.on('anvandare', function(responsdata) {
			console.log(responsdata);
			document.getElementById('tid').setAttribute('data-vgrid', responsdata.vgrid);
			var namn = document.getElementById('namn');
				removechilds(namn);
				var namntext = document.createTextNode('Välkommen ' + responsdata.namn);
				namn.appendChild(namntext);
			var listaprojekt = document.getElementById('listaprojekt');
			for (var a = 0; a < responsdata.projekt.length; a++){
				var option = document.createElement('option');
					option.setAttribute('value', responsdata.projekt[a]);
					var optiontext = document.createTextNode(config.projekt[responsdata.projekt[a]].namn);
					option.appendChild(optiontext);
				listaprojekt.appendChild(option);
			};
			showhide('login', 'projekt');
		});

		var removeError;
		socket.on('erroranvandare', function(message) {
			var error = document.getElementById('namnstatus');
				removeerror();
				var errortext = document.createTextNode('Användarnamn kunde inte hittas!');
				error.appendChild(errortext);
				clearTimeout(removeError);
				removeError = setTimeout(function(){ removeerror(); }, 3000);
			console.log('Användarnamn kunde inte hittas!');
		});
	</script>
</body>
</html>